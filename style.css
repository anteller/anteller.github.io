:root {
    --c-accent:#2563eb;
    --c-accent-hover:#1d4ed8;
    --c-warn:#dc2626;
    --c-ok:#16a34a;
    --c-bg:#f1f5fc;
    --c-panel:#ffffff;
    --c-border:#dbe2ea;
    --c-text:#222;
    --c-text-sub:#555;
    --c-toast-bg:#111;
    color-scheme: light dark;
}
body[data-theme="dark"] {
    --c-bg:#0f172a;
    --c-panel:#1e293b;
    --c-border:#334155;
    --c-text:#f1f5f9;
    --c-text-sub:#94a3b8;
    --c-accent:#3b82f6;
    --c-accent-hover:#2563eb;
    --c-warn:#f87171;
    --c-ok:#22c55e;
    --c-toast-bg:#0f172a;
}
@media (prefers-color-scheme: dark){
    body[data-theme="auto"] {
      --c-bg:#0f172a;
      --c-panel:#1e293b;
      --c-border:#334155;
      --c-text:#f1f5f9;
      --c-text-sub:#94a3b8;
      --c-accent:#3b82f6;
      --c-accent-hover:#2563eb;
      --c-warn:#f87171;
      --c-ok:#22c55e;
      --c-toast-bg:#0f172a;
    }
}
body {
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Sans","Noto Sans JP",sans-serif;
    background:var(--c-bg); margin:0; padding:0; color:var(--c-text); text-align:center;
    -webkit-font-smoothing:antialiased;
}
h1 { margin:12px 0 4px; font-size:clamp(1.4rem,2.2vw,1.7rem); letter-spacing:.05em; }
.container { max-width:1000px; margin:0 auto; padding:10px 16px 40px; }
.panel {
    background:var(--c-panel); border:1px solid var(--c-border);
    border-radius:10px; padding:18px 22px 30px; margin-top:16px; box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
.hidden { display:none !important; }

/* --- buttons --- */
.btn {
    background:var(--c-accent); color:#fff; border:none; padding:10px 18px;
    border-radius:6px; font-size:15px; cursor:pointer;
    display:inline-flex; gap:6px; align-items:center; user-select:none;
    transition:background .18s,transform .18s; font-weight:500;
}
.btn.small { padding:6px 12px; font-size:13px; }
.btn.secondary { background:#64748b; }
.btn.flat { background:#fff; color:var(--c-accent); border:1px solid var(--c-accent); }
body[data-theme="dark"] .btn.flat { background:transparent; color:var(--c-accent); }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .btn.flat { background:transparent; color:var(--c-accent); } }

.btn.alt { background:#fff; color:#0d4aa8; border:1px solid #0d4aa8; }
body[data-theme="dark"] .btn.alt { background:transparent; color:#60a5fa; border:1px solid #3b82f6; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .btn.alt { background:transparent; color:#60a5fa; border:1px solid #3b82f6; } }

.btn.alt:hover { background:#0d4aa8; color:#fff; }
body[data-theme="dark"] .btn.alt:hover { background:#3b82f6; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .btn.alt:hover { background:#3b82f6; } }

.btn.danger { background:var(--c-warn); }
.btn.warn { background:#f59e0b; }
.btn.down{ background:#3b82f6; color:#fff; }
.btn.down:hover{ background:#2563eb; }
body[data-theme="dark"] .btn.down{ background:#2563eb; }
body[data-theme="dark"] .btn.down:hover{ background:#1d4ed8; }
@media (prefers-color-scheme: dark){
  body[data-theme="auto"] .btn.down{ background:#2563eb; }
  body[data-theme="auto"] .btn.down:hover{ background:#1d4ed8; }
}

.btn:disabled { opacity:.55; cursor:not-allowed; }
.btn:hover:not(:disabled) { background:var(--c-accent-hover); }
.btn.flat:hover { background:var(--c-accent); color:#fff; }
.btn.danger:hover:not(:disabled) { background:#b91c1c; }
.btn.warn:hover:not(:disabled) { background:#d97706; }
.btn:active:not(:disabled) { transform:translateY(1px); }

/* --- genre buttons --- */
.genre-btn {
    min-width:140px; background:#fff; color:#111; border:1px solid var(--c-border);
    box-shadow:0 3px 7px rgba(0,0,0,.08); position:relative;
    padding-right:56px;
}
body[data-theme="dark"] .genre-btn { background:#1e293b; color:var(--c-text); border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .genre-btn { background:#1e293b; color:var(--c-text); border-color:#334155; } }

.genre-btn:hover { background:#eff6ff; }
body[data-theme="dark"] .genre-btn:hover { background:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .genre-btn:hover { background:#334155; } }

#genreButtons {
    display:flex; flex-wrap:wrap; gap:14px; justify-content:center; margin:20px 0 6px;
}

/* --- quiz choices --- */
.progress { font-size:14px; color:var(--c-text-sub); margin-bottom:6px; }
.question { font-size:clamp(19px,2.4vw,21px); font-weight:600; margin:12px 0 16px; line-height:1.5; }

.choices {
    display:grid; gap:18px; margin:10px auto 10px; width:100%; max-width:780px;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    padding-bottom:8px;
}
.choice {
    position:relative; min-height:88px; display:flex; align-items:center; justify-content:center;
    border:2px solid var(--c-accent); border-radius:14px; cursor:pointer; font-size:17px; font-weight:500;
    background:linear-gradient(var(--c-panel), var(--c-bg)); padding:12px 10px; text-align:center;
    box-shadow:0 3px 7px rgba(0,0,0,.08); transition:transform .15s,background .22s,border-color .22s;
    color:var(--c-text);
}
body[data-theme="dark"] .choice {
    background:linear-gradient(#1e293b,#0f172a);
    box-shadow:0 3px 7px rgba(0,0,0,.5);
}
@media (prefers-color-scheme: dark){
  body[data-theme="auto"] .choice {
    background:linear-gradient(#1e293b,#0f172a);
    box-shadow:0 3px 7px rgba(0,0,0,.5);
  }
}

.choice:hover { background:#f0f7ff; }
body[data-theme="dark"] .choice:hover { background:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .choice:hover { background:#334155; } }

.choice:active { transform:scale(.97); }
.choice.correct { border-color:var(--c-ok); background:#dcfce7; }
body[data-theme="dark"] .choice.correct { background:#14532d; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .choice.correct { background:#14532d; } }

.choice.wrong { border-color:var(--c-warn); background:#fee2e2; }
body[data-theme="dark"] .choice.wrong { background:#4c1d1d; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .choice.wrong { background:#4c1d1d; } }

.choice .badge {
    position:absolute; top:6px; left:8px; font-size:12px; background:var(--c-accent); color:#fff;
    padding:2px 6px; border-radius:50px; letter-spacing:.5px;
}

/* --- result/explanation --- */
.result-msg { font-size:26px; font-weight:600; margin:14px 0 6px; min-height:36px; }
.result-sub { font-size:14px; color:var(--c-text-sub); min-height:20px; }
.explanation {
    margin:14px auto 4px; padding:14px 18px; max-width:780px; background:var(--c-panel);
    border:1px solid #cfe0f3; border-left:5px solid var(--c-accent); border-radius:10px;
    text-align:left; line-height:1.5; font-size:15px; display:none; white-space:pre-wrap;
    color:var(--c-text);
}
body[data-theme="dark"] .explanation { border-color:#334155; border-left-color:var(--c-accent); }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .explanation { border-color:#334155; border-left-color:var(--c-accent); } }

.explanation.visible { display:block; animation:fadeIn .35s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(4px);} to{opacity:1; transform:translateY(0);} }

.wrong-list {
    list-style:decimal; padding-left:1.4em; text-align:left; max-width:780px; margin:8px auto 0;
    font-size:15px; line-height:1.4; color:var(--c-text);
}
.wrong-list li {
  margin:6px 0 10px;
  background:var(--c-panel);
  border:1px solid var(--c-border);
  padding:8px 10px 10px;
  border-radius:8px;
  border-left:5px solid var(--c-warn);
}
.wrong-list li .exp {
    margin-top:4px; font-size:13px; color:var(--c-text); padding:6px 8px;
    background:#f1f5f9; border-radius:6px; line-height:1.4; white-space:pre-wrap;
}
body[data-theme="dark"] .wrong-list li .exp { background:#334155; color:var(--c-text); }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .wrong-list li .exp { background:#334155; color:var(--c-text); } }

.right-list li { border-left:5px solid var(--c-ok); }

/* --- forms --- */
form { display:flex; flex-direction:column; gap:16px; max-width:620px; margin:0 auto; width:100%; }
label.form-label { display:flex; flex-direction:column; align-items:flex-start; font-size:14px; gap:6px; width:100%; }
input[type=text], input[type=number], textarea, select {
    font-size:16px; padding:8px 10px; width:100%; border-radius:6px; border:1px solid var(--c-border);
    background:var(--c-panel); font-family:inherit; resize:vertical; color:var(--c-text);
}
textarea { min-height:90px; }
input:focus, textarea:focus, select:focus { outline:2px solid #bfdbfe; border-color:var(--c-accent); }
body[data-theme="dark"] input,
body[data-theme="dark"] textarea,
body[data-theme="dark"] select,
body[data-theme="auto"] input,
body[data-theme="auto"] textarea,
body[data-theme="auto"] select {
    border-color:#334155;
}
fieldset { border:1px solid var(--c-border); border-radius:8px; padding:14px 16px 18px; text-align:left; background:var(--c-panel); }
fieldset legend { padding:0 6px; font-weight:600; }

/* --- editor --- */
.choice-editor-row {
    display:flex; gap:8px; align-items:center; flex-wrap:wrap; background:var(--c-panel); border:1px solid #d5dde6;
    padding:8px 10px; border-radius:8px;
}
body[data-theme="dark"] .choice-editor-row { border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .choice-editor-row { border-color:#334155; } }

.choice-editor-row input[type=text] { flex:1 1 260px; }
.choice-editor-row .radio-wrap { display:flex; align-items:center; gap:4px; font-size:12px; }
.remove-choice-btn {
    background:#ef4444; color:#fff; border:none; font-size:12px; padding:4px 8px; border-radius:4px; cursor:pointer;
}
.remove-choice-btn:hover { background:#dc2626; }
.add-choice-btn {
    background:#10b981; color:#fff; border:none; font-size:13px; padding:6px 12px;
    border-radius:6px; cursor:pointer; margin-top:4px;
}
.add-choice-btn:hover { background:#059669; }

.inline-actions { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:18px; }

/* --- toast --- */
.toast {
    position:fixed; left:50%; bottom:20px; transform:translateX(-50%) translateY(30px);
    background:var(--c-toast-bg); color:#fff; padding:10px 18px; border-radius:26px; font-size:14px;
    opacity:0; pointer-events:none; transition:all .4s; z-index:100; box-shadow:0 5px 18px rgba(0,0,0,.3);
    max-width:80%; line-height:1.4;
}
.toast.show {
    opacity:1; transform:translateX(-50%) translateY(0);
    pointer-events:auto;
}
.toast a.undo-link { color:#60a5fa; text-decoration:underline; margin-left:12px; cursor:pointer; font-weight:600; }

/* --- I don't know button --- */
.dontknow-wrap { margin:14px auto 2px; display:flex; justify-content:center; }
#iDontKnowBtn {
    font-size:16px; line-height:1.25; padding:12px 28px; background:#64748b; border:1px solid #64748b;
    border-radius:10px; min-height:48px; min-width:140px; display:inline-flex; align-items:center; justify-content:center;
    font-weight:600; transition:background .18s, transform .15s;
}
#iDontKnowBtn:hover { background:#475569; }
#iDontKnowBtn:active { transform:scale(.95); }
body[data-theme="dark"] #iDontKnowBtn { background:#475569; border-color:#475569; }
body[data-theme="dark"] #iDontKnowBtn:hover { background:#334155; }
@media (prefers-color-scheme: dark){
  body[data-theme="auto"] #iDontKnowBtn { background:#475569; border-color:#475569; }
  body[data-theme="auto"] #iDontKnowBtn:hover { background:#334155; }
}

/* --- next button --- */
#nextQuestionBtn { display:none; }

/* --- manage header --- */
.manage-header { display:flex; flex-wrap:wrap; gap:12px; justify-content:space-between; align-items:center; }
.manage-header .title { font-size:20px; font-weight:600; }

.manage-controls { display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; margin-top:10px; text-align:left; }
.manage-controls > div { display:flex; flex-direction:column; gap:4px; }

.question-list { margin-top:16px; list-style:none; padding:0; display:flex; flex-direction:column; gap:10px; }
.question-item {
    background:var(--c-panel); border:1px solid var(--c-border); padding:10px 12px 12px; border-radius:8px;
    text-align:left; position:relative; display:flex; flex-direction:column; gap:6px;
}
body[data-theme="dark"] .question-item { border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .question-item { border-color:#334155; } }

.q-row-top { display:flex; justify-content:space-between; gap:12px; }
.q-main { font-weight:600; font-size:15px; line-height:1.4; flex:1; }
.q-meta { font-size:11px; color:var(--c-text-sub); display:flex; flex-wrap:wrap; gap:8px; }
.q-actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:4px; }
.q-actions .btn.small { font-size:12px; padding:5px 10px; }
.badge-inline { display:inline-block; background:var(--c-accent); color:#fff; font-size:11px; padding:2px 6px; border-radius:50px; letter-spacing:.5px; }
.tag-badge { display:inline-block; background:#e0f2fe; color:#0369a1; font-size:11px; padding:2px 6px; border-radius:4px; margin-right:4px; margin-top:2px; line-height:1.2; }
body[data-theme="dark"] .tag-badge { background:#334155; color:#93c5fd; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .tag-badge { background:#334155; color:#93c5fd; } }

.bulk-bar {
    margin-top:14px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
    background:#f1f5f9; padding:8px 12px; border-radius:8px; border:1px solid #dbe4ef;
}
body[data-theme="dark"] .bulk-bar { background:#1e293b; border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .bulk-bar { background:#1e293b; border-color:#334155; } }

.bulk-info { font-size:12px; color:var(--c-text); }

#manageBackBtn2{ background:#dc2626; }
#manageBackBtn2:hover{ background:#b91c1c; }

.genre-manage-list { list-style:none; padding:0; margin:16px 0 0; display:flex; flex-direction:column; gap:10px; }
.genre-item {
    background:var(--c-panel); border:1px solid var(--c-border); padding:10px 12px;
    border-radius:8px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
}
body[data-theme="dark"] .genre-item { border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .genre-item { border-color:#334155; } }

.genre-name { font-weight:600; font-size:15px; }
.genre-actions { display:flex; gap:8px; flex-wrap:wrap; }

#questionCountScreen .count-buttons {
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:18px 0 8px;
}
#questionCountScreen .count-buttons .group {
    display:flex; flex-direction:column; gap:6px; align-items:stretch; min-width:140px;
}
#questionCountScreen .count-buttons .group .label { font-size:11px; color:var(--c-text-sub); text-align:center; }

@media (max-width:820px){
    h1 { font-size:clamp(1.25rem,5vw,1.5rem); }
    .question { font-size:clamp(18px,4.8vw,20px); }
    .choice { min-height:78px; font-size:16px; }
    .panel { padding:16px 16px 28px; }
    .choice-editor-row { flex-direction:column; align-items:stretch; }
    .choice-editor-row input[type=text]{ flex:1 1 auto; width:100%; }
    .manage-header { flex-direction:column; align-items:flex-start; }
}
@media (max-width:560px){
    .btn.small { padding:10px 14px; font-size:14px; }
    .choice { padding:18px 12px; min-height:90px; }
}

.manage-list-toolbar{ display:flex; justify-content:flex-end; margin-top:6px; margin-bottom:4px; }
.sort-compact select{ font-size:12px; padding:4px 6px; border:1px solid var(--c-border); border-radius:5px; background:var(--c-panel); min-width:140px; }
body[data-theme="dark"] .sort-compact select{ border-color:#334155; background:#1e293b; color:var(--c-text); }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .sort-compact select{ border-color:#334155; background:#1e293b; color:#fff; } }
.manage-controls #tagFilterInput{ max-width:260px; width:100%; flex:0 0 auto; }
.manage-controls > div{ position:relative; z-index:1; }

/* --- flag button --- */
.flag-btn{
    background:#fff; color:#f59e0b; border:1px solid #fbbf24; padding:4px 10px; font-size:13px; border-radius:20px; cursor:pointer; display:inline-flex; align-items:center; gap:4px; line-height:1.2; font-weight:600; }
body[data-theme="dark"] .flag-btn{ background:#1e293b; color:#fbbf24; border-color:#f59e0b; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .flag-btn{ background:#1e293b; color:#fbbf24; border-color:#f59e0b; } }
.flag-btn:hover{ background:#fff3d3; }
body[data-theme="dark"] .flag-btn:hover{ background:#43380d; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .flag-btn:hover{ background:#43380d; } }
.flag-btn.active{ background:#f59e0b; color:#fff; border-color:#d97706; }
body[data-theme="dark"] .flag-btn.active{ background:#d97706; border-color:#b45309; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .flag-btn.active{ background:#d97706; border-color:#b45309; } }
.flag-btn.active:hover{ filter:brightness(1.05); }

.btn.small.flat.active{ background:var(--c-accent); color:#fff; }
body[data-theme="dark"] .btn.small.flat.active{ background:var(--c-accent); color:#fff; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .btn.small.flat.active{ background:var(--c-accent); color:#fff; } }

/* --- priority adjust --- */
#priorityAdjustWrap{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
.priority-indicator{ font-size:12px; color:var(--c-text-sub); padding:4px 8px; border:1px solid var(--c-border); border-radius:14px; background:var(--c-panel); }
body[data-theme="dark"] .priority-indicator{ border-color:#334155; }
@media (prefers-color-scheme: dark){ body[data-theme="auto"] .priority-indicator{ border-color:#334155; } }

/* --- manage priorityFactor --- */
.pf-actions{ display:flex; flex-wrap:wrap; gap:4px; align-items:center; }
.pf-indicator-badge{ background:#f59e0b; color:#fff; font-size:11px; padding:2px 6px; border-radius:14px; letter-spacing:.5px; }
.btn.pf-up{ background:#f59e0b; }
.btn.pf-up:hover{ background:#d97706; }
.btn.pf-down{ background:#64748b; }
.btn.pf-down:hover{ background:#475569; }
body[data-theme="dark"] .btn.pf-down{ background:#475569; }
body[data-theme="dark"] .btn.pf-down:hover{ background:#334155; }
@media (prefers-color-scheme: dark){
  body[data-theme="auto"] .btn.pf-down{ background:#475569; }
  body[data-theme="auto"] .btn.pf-down:hover{ background:#334155; }
}

/* アクセシビリティ */
.visually-hidden { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }

/* ===== ジャンルカード常設メニュー（⋮） ===== */
.genre-btn { position: relative; }
.genre-menu-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  right: 6px;
  width: 36px;
  height: 36px;
  min-width: 36px;
  min-height: 36px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 999px;
  background: var(--c-panel);
  color: var(--c-text-sub);
  border: 1px solid var(--c-border);
  cursor: pointer;
  z-index: 2;
  line-height: 1;
  font-size: 18px;
  user-select: none;
}
.genre-menu-btn:hover { background:#f3f6fc; }
body[data-theme="dark"] .genre-menu-btn { background:#1e293b; color:var(--c-text); border-color:#334155; }
body[data-theme="dark"] .genre-menu-btn:hover { background:#263445; }
.genre-menu-btn:active { transform: translateY(-50%) scale(0.98); }
.genre-menu-btn:focus-visible { outline:3px solid #93c5fd; outline-offset:2px; }

@media (max-width: 560px){
  .genre-menu-btn { width:40px; height:40px; min-width:40px; min-height:40px; font-size:20px; }
}

/* ===== モバイルOS (Android/iOS) のみジャンルフィルタ非表示 ===== */
body.is-mobile-os #manageScreen .genre-filter-label,
body.is-mobile-os #manageScreen #genreFilterSelect {
  display:none !important;
}
